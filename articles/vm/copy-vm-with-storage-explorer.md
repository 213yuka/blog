Azure Storage Explorer を用いて、コマンド無しで VM
を別のリージョン・サブスクリプション・テナントに移動 /
複製（コピー）をしてみよう

2022年5月25日

14:10

こんにちは、Azure テクニカル サポート チームの富田です。

 

Azure 上の VM について、

　・別のリージョンに移動/複製をしたい

　・別のサブスクリプションに移動/複製をしたい

　・別のテナントにあるサブスクリプションに移動/複製をしたい

というご要望をいただくことがございます。

 

これらを実現する手段は幾つかありますが、

Azure Storage Explorer を使うと、上記のご要望がコマンド不要で全て GUI
で完結することが可能です！

今回はこの方法についてスクリーンショットを交えて紹介させていただきます。

 

ー－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－

 

まず、大まかな流れについてご説明させていただきます。

 

Azure Storage Explorer をインストールする

Azure Storage Explorer で対象のサブスクリプションに接続する

対象の VM を割り当て解除（停止）する

OS ディスクのスナップショットを一時的に作成

スナップショットから転送用ディスクを一時的に作成

転送用ディスクを移行先に複製する

複製したディスクから新規に VM を作成する

不要となったリソースを削除する

 

![VM の OS テ ィ ス ク カ 、 ら ・ 一 旦 ス ナ ッ プ シ ョ ッ ト を 作
成 し こ れ を 別 の サ プ ス ク リ プ シ ョ ン や リ ー ジ ョ ン に 転
送 し ま す ! 一 時 的 に OS デ ィ ス ク の コ ヒ 。 ー を 作 成 し て
](media/image1.png){width="14.591666666666667in"
height="2.8916666666666666in"}

 

勿論この方法で、

　・マネージドディスクだけを複製する

　・データディスクも含めて複製する

　・同一のサブスクリプション内に VM を複製する

といったことも可能です。

 

なお、本手順としては OS ディスクを転送するのですが、

稼働中の VM の場合は、アタッチ済みの OS
ディスクのリージョン間コピーができません。

また、鄭素中でもそのまま VM に接続にアタッチされている OS
ディスクを転送開始すると、転送中は VM
が起動できないという制約もあります。

 

そのため、一旦 OS ディスクのコピーを一時的に作成して、

その一時的に作成した OS ディスクのコピーを転送するという方法をとります。

 

 

ー－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－

・VM 複製時の注意

 

 

 

 

また、転送には所定の料金が発生したしますのでこの点ご留意くださいませ。

 

■ご参考：帯域幅 の価格

<https://azure.microsoft.com/ja-jp/pricing/details/bandwidth/>

 

ー－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－

・Azure Storage Explorer をインストールする

 

まずは Azure Storage Explorer をインストールしましょう。

以下の URL より Azure Storage Explorer をインストールします。

 

■ご参考：Azure Storage Explorer

<https://azure.microsoft.com/ja-jp/features/storage-explorer/>

 

ー－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－

・Azure Storage Explorer で対象のサブスクリプションに接続する

 

インストールが完了したら、Azure Storage Explorer
を開き、各種操作が可能な Azure ユーザーでログインをします。

コンセントのアイコンの「接続ダイアログを開く」を選択し、「サブスクリプション」を選択の上ログインを実施ください。

 

![フ ァ イ ル 編 集 表 小 ヘ ル フ リ リ - ス ノ - ト : 124P 刄 リ ソ ー
ス の 検 幸 : 、 A 川 0 ge へ 1 を 続 す る リ ソ ー ス の 選 択 リ ソ
ー ス の 選 択 ) 認 証 接 続 接 続 先 の ure リ ソ ー ス の 種 類 サ プ
ス ク リ プ シ ョ ン ア ク セ ス で き る サ プ ス ク リ プ シ ョ ン の
既 0B 、 フ ァ イ ) し 、 キ ュ ー 、 テ ー し な ど の ス ト レ ー ジ
リ ソ ー ス に ア ク セ ス す る に は 、 Azure に サ イ ン イ ン し 〉
ま す . ス ト レ ー ジ ア カ ウ ン ト ま た は サ ー ビ ス ス ト レ ー
ジ ア カ ウ ン ト の 1 つ ま た は 複 数 の サ ー ビ ス に ア タ ッ チ
し ま す . BLOB コ ) ′ テ サ - ー 個 々 の 亂 0B コ ン テ ナ - に ア タ
ッ チ し ま す . ADLS Gen2 コ ン テ ナ ー ま た は デ ィ レ ク ト リ 個
々 の ADLS 6 印 2 コ ン テ ナ - ま た は デ ィ レ ク ト リ に ア タ ッ
チ し ま す . ・ フ ァ イ ル 共 有 ・ 個 々 の フ ァ イ 儿 共 有 に ア
タ ッ チ し ま す . キ ュ ー 個 々 の キ ュ ー に ア タ ッ チ し ま す
. - テ \-- プ ル 個 々 の テ - プ ル に ア タ ッ チ し ま す . キ ャ ン
セ ル ](media/image2.png){width="9.6in" height="7.833333333333333in"}

 

なお、別のテナントに VM
コピーを試みる場合は上記のログイン作業を、２回実施します。

「移行元サブスクリプション」「移行先サブスクリプション」と 2
つともログインしておきましょう。

 

 

ー－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－

・対象の VM を割り当て解除（停止）する

 

スナップショットをとるため、対象となる VM を Azure
ポータル等で割り当て解除（停止）しましょう。

 

![makel 仮 魍 マ シ ン ー ア ク テ ィ ビ テ ィ 0 ク ア ク セ ス 制 第
()A \> 煢 第 再 ロ 停 止 キ ャ プ チ ャ リ ソ - ス ク ル - プ に ・ 行
0m ⅲ 292 し n 。 東 日 本 C, な ン 2 ) 場 所
](media/image3.png){width="5.0in" height="1.65in"}

 

スナップショット自体は、VM が起動状態でも取得可能ですが、

移行後の VM の不具合を防止するため VM
停止状態でスナップショットを取得することを強く推奨いたします。

 

ー－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－

・OS ディスクのスナップショットを一時的に作成

 

VM 停止が完了したら、VM の \[ディスク\]
ブレードより、複製を行いたいディスクを選択します。

 

![第 makell デ ィ ス ク 仮 を マ シ ン ■ ア ク テ ィ ビ テ ィ 吃 ア ク
セ ス 制 第 ()A ・ タ グ ′ 問 題 の 診 新 と 解 決 ゑ 衫 ト ワ - ク サ
イ ズ ・ セ キ ュ リ テ ィ ・ ム 一 の 准 事 項 最 新 の 情 報 に 史 新
デ ィ ス ク デ ィ ス ク の ス ワ ッ プ n い kel - 印 5k1-90 第 0b8 「
1e1746a 「 3 日 e70103 ) f5 お デ - タ デ ィ ス ク 刄 名 前 て フ ィ ル
タ - し て く た さ い ア タ 分 さ れ た デ - タ デ ィ ス ク 0 健 の う
ら 0 番 目 を 表 示 し て い 追 加 設 定 ス ト し - ジ の 種 類 十 新 し
い デ ィ ス ク を 作 成 し 接 続 す る デ ィ ス ク 名 デ - タ デ ィ ス
ク が さ れ な い 取 存 の デ ィ ス ク の ア タ ッ チ ス ト レ - ジ の
種 製 ](media/image4.png){width="5.0in" height="3.0833333333333335in"}

 

上部にある \[スナップショットの作成\] を選択します。

 

![: fromłmageun ](media/image5.png){width="5.0in"
height="1.6083333333333334in"}

 

スナップショット作成のオプションを選択します。

下記は一例とはなりますが、今回はスナップショットの種類は \[フル\]
とし、記憶域の種類は \[Standard HDD\] としています。

設定が完了したら、\[レビュー\] を選択し、スナップショットを作成します。

 

![ス ナ ッ プ シ ョ ッ ト の 作 成 ス ナ ッ プ シ 弖 ッ ト は 、 仮 判
ト ド ド ラ イ プ MHD) の 読 み 取 り 用 \] ビ - で す . ク ア ッ プ と
し て 使 用 す る 05 ま た は デ - タ デ ィ ス ク Ⅵ の ス ナ ッ プ シ ョ
ッ ト を 作 成 す る か 、 仮 を マ シ ン (vM) の 問 題 の ト つ プ ル
シ ュ - ア イ ン グ を 行 う こ と が で き ま す . A 劇 他 の ス す ッ
プ シ 土 小 の 詳 を ま ホ し ま す 九 ジ ェ ク ト の 詳 ・ デ ブ 0 イ
さ れ て い る リ ソ - ス と コ ス ト を 理 す る サ プ ス ク リ プ シ
\] ン を 選 択 し ま す . フ ォ ル ダ - の よ ) な リ ソ - ス グ ル - プ
を 使 用 し て 、 す べ て の リ ソ - ス を 整 理 し 、 管 理 し ま す .
サ プ ス ク リ プ ン 0 リ ソ - ス ク ル - プ ・ ① イ ン ス タ ン ス の
詳 第 名 前 ・ ス ナ ッ カ ョ ッ ト の 題 ・ 0 記 を 域 の 類 ・ 0 以 前
f 「 聞 曲 物 ー 新 新 覗 年 " pshot ・ 1 ◎ フ ル ・ 駅 し た デ ィ ス
ク の 冗 全 な 読 み 取 り 専 用 コ ビ - を 作 成 し ま す . 墸 分 - 前
回 の ス ナ ッ シ ぅ ッ ト と の 差 に づ い て デ ィ ス ク の 部 分 コ
ヒ - を 作 成 す る こ と に よ リ 、 ス ト い ジ 」 ス ト を 節 約 し
ま す . 過 計 d H00 ](media/image6.png){width="5.0in" height="4.325in"}

 

これでスナップショット取得が完了となります。

なお、スナップショット取得は一概には言えませんが、手元の Windws OS
ディスク 128 GB では十数秒で完了しました。

スナップショット取得が完了したら、VM を起動頂いて大丈夫です。

 

ー－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－

・スナップショットから転送用ディスクを一時的に作成

 

先ほど取得したスナップショットから一時的に転送用ディスクを作成します。

まずは、ポータル上部の検索ボックスで \[スナップショット\]
を検索し、選択します。

 

![″일7날"卜 ](media/image7.png){width="4.65in"
height="1.3166666666666667in"}

 

先ほど取得したスナップショットを一覧より選択します。

 

![ス ナ ッ プ シ ョ ッ ト 新 規 ビ \] - の 管 理 、 / サ 5 件 中 1 \~ 5
件 の い - ド を 表 示 し て い ま す . ロ 名 前 ↑ ー 第 ! naps を ) t
-001 ](media/image8.png){width="3.441666666666667in"
height="3.5416666666666665in"}

 

上部に表示される \[ディスクの作成\] を選択します。

 

![snapshot -001 を ス ナ ッ フ シ ョ ッ ト ・ ア ク テ ィ ビ テ イ ロ グ
ア ク セ ス 制 第 ( 十 デ ィ ス ク の 作 成 薗 4 0 最 新 の 情 報 に 史
新 リ ソ ー ス ク ル ー プ ( 変 カ ビ ジ 虹 ン グ 状 襲 : ト 屋 ge し 卩
S ょ ェ 2 」 1 東 日 本 ](media/image9.png){width="5.0in"
height="1.6916666666666667in"}

 

「転送用ディスク」としてマネージドディスクを作成します。

基本的には、デフォルトの設定で問題無いかと思いますが、下記例ではサイズにて
\[Standard HDD\] のディスクを作成するように設定しています。

設定が完了したら \[確認および作成\]
を選択し、マネージドディスクを作成します。

 

![マ ネ ー ジ ド デ ィ ス ク の 作 成 黯 号 化 ネ ッ ト ワ - ク 詳 を タ
グ 確 認 お よ び 作 成 基 本 ワ - ク ロ - ド に 必 要 な デ ィ ス ク び
類 と サ イ ズ を 選 択 し ま す .2 2 デ ィ ス ク は 99 雪 99 % の 可 用
性 で 設 計 さ れ て い ま す .2 は 2 マ ネ - ジ ド デ ィ ス ク は 定 で
。 r semce Encryption を 使 用 し ( 保 を デ - タ を 号 化 し ま す . デ
ィ ス ク の 詳 。 九 ジ 1 ク ト の 詳 第 デ 加 イ さ れ ( い る リ ソ -
ス と 」 ス ト を 言 理 す る サ プ ス ク リ 乃 \] ン を 選 択 し ま す
. フ ォ ル タ - の よ う な リ ソ - ス ク ル - プ を 使 用 し て 、 す
べ て の リ ソ - ス を 整 理 し 管 理 し ま す . サ プ ス ク リ プ シ ョ
ン 0 リ ソ - ス ク 」 ト プ を 0 デ ィ ス ク の 詳 細 デ ィ ス ク 名 ・
0 可 用 性 ゾ - ン ソ - ス の を 題 〇 ソ - ス の ス ナ ッ プ シ ョ ッ
ト 0 サ イ ズ ・ 0 第 認 み よ び 作 成 行 禳 0 旧 un 新 規 作 成 な し
ょ ⅵ 師 d H00 サ イ ス を 変 更 し ま す 次 : 爾 号 化 、
](media/image10.png){width="5.0in" height="4.783333333333333in"}

 

 

ー－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－

・対象の VM の OS ディスクを移行先に複製する

 

無事に「転送用ディスク」が作成できたら、これを転送先にコピーしましょう。

 

Azure Storage Explorer にて、

左側のエクスプローラーより先ほど作成した「転送用ディスク」あるリソースグループを選択します。

そして、対象のディスクを選択し「コピー」を選択します。

 

![こ M に 950 れ Azure 0 ge Ex 0 に 一 丿 ア イ ル 編 集 表 示 ヘ ル プ
ェ ク ス プ ロ \-- ラ \-- 刄 リ ソ ー ス の 検 索 ▽ す ′ す ま を を )
情 報 に 更 新 ↑ ア ッ プ ロ - ド デ ィ ス ク 名 リ リ ー ス ノ ↓ ダ ウ
ン ロ - ド ー ト 124 ・ 0 コ ビ - X 削 除 ス ナ ッ プ シ ョ ッ ト の 貼
り 何 け 中 ヤ Intemal-subscription \> - ス ト レ ー ジ ア ガ 、 / 品
Disks 第 AAA \[ ・ \] AFS AzureBackt-JB cloudshell ス ト レ ー ジ ア カ
ウ ン ト の 種 類 引 \'id 計 d HDD
](media/image11.png){width="9.166666666666666in"
height="3.5083333333333333in"}

 

次に、エクスプローラーで複製先となるリソースグループを選択の上、「貼り付け」を選択します。

この際、別テナントや別サブスクリプション上のリソースグループも選択が可能です。

以下のように複製先のリージョンを選ぶことが可能となっております。

 

![丿 ァ イ ル 編 集 表 示 ヘ ル プ ェ ク ス プ ロ ー ラ ー 刄 リ ソ \--
ス の 検 索 ▽ す ′ す ま を を 新 ) 情 報 に 更 新 \[ ・ \] AFS 靄 PE ◎
SIG 〔 ・ い pd ー ス ノ ー ト : 124.0 X ↑ ア ッ プ ロ - ド デ ィ ス ク
名 タ ワ ン ロ - ド コ ヒ - 貼 り 付 け 削 除 ス ナ ッ プ シ ョ ッ ト の
... 中 ヤ ⅲ ma ト su ロ tion \> - ス ト レ ー ジ ア カ ー 、 、 / 第 D
第 AAA AzureBackug cloudshell Default-Stor ◎ DefaultRes01 DefaultRes01
Keep 第 NetworkWat 靄 NSG sadaike-san Snap 第 SUSE Unmanaged 靄 VMSS ◎
w1n19e Ⅷ n19 ル 〔 ・ \] Ⅷ n22 ス ト レ ー ジ ア カ ウ ン ト の 種 類 デ
ィ ス ク が 見 つ か り ま せ ん ニ デ ィ ス ク の お り 付 け デ ィ ス
ク の 貼 り 付 け デ ィ ス ク の 名 前 を 指 定 し て か ら 、 残 り の
バ ラ メ - タ ー を 指 定 し て く だ さ い 。 デ ィ ス ク 名 west-disk
西 日 本 可 用 性 ゾ - ン ア カ ウ ン ト の 種 類 : Standard HDD り 何
け キ ャ ン セ ル ](media/image12.png){width="8.791666666666666in"
height="7.966666666666667in"}

 

同一リソースグループ内に同一名のマネージドディスクは作成が叶いませんので、その際は上記画面でディスク名を変更くださいませ。

なお、転送状況は以下の通り Azure Storage Explorer
下部のアクティビティタブにてご確認が可能です。

 

![ア ク テ ィ ビ テ ィ ク リ ア の 完 了 ク リ ア に 成 功 し ま し た ◎
丿 ソ - ス グ 丿 し 一 プ ・ A ・ の デ ィ ス ク ⅶ sk -001 ・ が リ ソ -
ス グ 丿 レ - プ ・ A ・ の デ ィ ス ク ・ disk - 開 Idd ・ に 正 常 に
コ ビ ー さ れ ま し た ポ ー タ ル で 開 く
](media/image13.png){width="9.658333333333333in"
height="1.5916666666666666in"}

 

なお、データディスクも合わせて複製する必要がある場合は同様の手順で、OS
ディスクと合わせて複製を行ってください。

 

ー－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－

・複製した OS ディスクから新規に VM を作成する

 

Azure ポータルで、移行先の複製した OS ディスクのリソースを表示します。

複製した OS ディスクから以下の通り VM 作成が可能です。

 

![disk-OOI デ ィ ス ク 刃 ト 第 に ー ア ク テ ィ ビ テ ィ 0 グ ア ク セ
ス 制 第 OA VM の 作 鼠 ス ナ ッ プ シ 疆 ト の 作 鼠 「 「 削 除 リ
ン - ス グ ル - プ に 更 ) . 行 。 un デ ィ ス ク の 状 甅 : 東 日 本
](media/image14.png){width="5.0in" height="1.7in"}

 

データディスクがある場合は、この VM
作成時にデータディスクをアタッチしましょう。

 

ー－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－

・不要となったリソースを削除する

 

不要な課金を無くすためにも、この手順で一時的に作成した「スナップショット」および「転送用のマネージドディスク」を削除しましょう。

また VM 複製でなく、移動の場合は複製完了後に移行元の VM
および不要なリソースを削除いただくようにお願いいたします。
